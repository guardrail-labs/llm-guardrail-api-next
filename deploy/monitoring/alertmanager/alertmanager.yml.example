global:
  resolve_timeout: 5m

route:
  receiver: default
  group_by: ["alertname", "namespace"]
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 2h
  routes:
    # Pages
    - matchers:
        - severity="critical"
      receiver: pagerduty
      continue: false

    # Warnings to Slack
    - matchers:
        - severity="warn"
      receiver: slack
      continue: false

receivers:
  - name: default
    slack_configs:
      - api_url: "https://hooks.slack.com/services/XXX/YYY/ZZZ"
        channel: "#alerts-guardrail"
        send_resolved: true
        text: |
          [{{ .Status | toUpper }}] {{ .CommonAnnotations.summary }}
          {{ range .Alerts }}
          • {{ .Annotations.description }}
          {{ end }}

  - name: pagerduty
    pagerduty_configs:
      - routing_key: "<PAGERDUTY_INTEGRATION_KEY>"
        severity: critical
        send_resolved: true
        description: >
          {{ .CommonAnnotations.summary }} — {{ .CommonAnnotations.description }}

  - name: slack
    slack_configs:
      - api_url: "https://hooks.slack.com/services/XXX/YYY/ZZZ"
        channel: "#alerts-guardrail"
        send_resolved: true
        title: "{{ .CommonAnnotations.summary }}"
        text: "{{ .CommonAnnotations.description }}"
