global:
  resolve_timeout: 5m

route:
  # Default sink for unmatched alerts (intentionally drops notifications)
  receiver: blackhole
  group_by: ['alertname', 'job']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  routes:
    - matchers:
        - severity="critical"
      receiver: pagerduty
    - matchers:
        - severity="warning"
      receiver: ops-slack

inhibit_rules:
  - source_matchers: ['severity="critical"']
    target_matchers: ['severity="warning"']
    equal: ['alertname', 'job']

receivers:
  # Valid receiver that drops alerts (keeps the root route legal)
  - name: blackhole

  # Example PagerDuty receiver
  # NOTE: Use routing_key_file via Helm Secret mount in real deployments.
  # The placeholder below lets amtool validate without secrets.
  - name: pagerduty
    pagerduty_configs:
      - routing_key: "00000000000000000000000000000000"  # placeholder
        severity: critical
        send_resolved: true

  # Example Slack receiver
  # Prefer file-based secret so CI lint doesn't need a real URL.
  # Mount a Secret at /etc/alertmanager/secrets/slack_webhook_url.
  - name: ops-slack
    slack_configs:
      - api_url_file: /etc/alertmanager/secrets/slack_webhook_url
        channel: "#ops-guardrail"
        send_resolved: true
