groups:
  - name: guardrail.recordings
    interval: 30s
    rules:
      - record: guardrail:decisions:availability_30d
        expr: |
          1 - (
            sum(rate(http_server_errors_total{job="guardrail", route="decisions"}[30d])) /
            sum(rate(http_requests_total{job="guardrail", route="decisions"}[30d]))
          )

      - record: guardrail:decisions:p95_latency_5m
        expr: |
          histogram_quantile(
            0.95,
            sum by (le) (rate(http_request_duration_seconds_bucket{job="guardrail", route="decisions"}[5m]))
          )

      - record: guardrail:webhook:delivery_success_30m
        expr: |
          1 - (
            sum(rate(guardrail_webhook_fail_total[30m])) /
            sum(rate(guardrail_webhook_attempt_total[30m]))
          )

      - record: guardrail:webhook_dlq_depth:max_5m
        expr: max_over_time(guardrail_webhook_dlq_depth[5m])
