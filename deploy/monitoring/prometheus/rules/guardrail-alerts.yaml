groups:
  - name: guardrail.alerts
    rules:
      - alert: GuardrailReadinessCritical
        expr: (guardrail_readyz_ok == 0) or (guardrail_readyz_redis_ok == 0)
        for: 5m
        labels:
          severity: "critical"
        annotations:
          summary: "Guardrail not ready"
          description: "Ready check failing for >=5m."

      - alert: GuardrailWebhookDLQBacklogWarn
        expr: guardrail:webhook_dlq_depth:max_5m > 0
        for: 5m
        labels:
          severity: "warning"
        annotations:
          summary: "Webhook DLQ backlog present"
          description: "There is a non-zero DLQ backlog."

      - alert: GuardrailWebhookDLQBacklogCrit
        expr: guardrail:webhook_dlq_depth:max_5m > 0
        for: 15m
        labels:
          severity: "critical"
        annotations:
          summary: "Webhook DLQ backlog sustained"
          description: "Non-zero DLQ backlog sustained for >=15m (likely stuck deliveries)."

      - alert: GuardrailLatencyP95High
        expr: guardrail:decisions:p95_latency_5m > 0.3
        for: 10m
        labels:
          severity: "warning"
        annotations:
          summary: "Decisions p95 latency > 300ms"
          description: "Sustained p95 > 300ms over 10m"

      - alert: GuardrailAvailabilitySLOMiss
        expr: guardrail:decisions:availability_30d < 0.999
        for: 30m
        labels:
          severity: "critical"
        annotations:
          summary: "Availability SLO miss (30d)"
          description: "Availability below 99.9% (rolling 30d window)."
