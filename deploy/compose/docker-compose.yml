version: "3.9"

services:
  guardrail:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        VERSION: "dev"
        VCS_REF: "local"
    image: llm-guardrail-api:dev
    container_name: llm-guardrail-api
    ports:
      - "8000:8000"
    env_file:
      - .env
    environment:
      POLICY_RULES_PATH: /etc/guardrail/rules.yaml
      POLICY_AUTORELOAD: "true"
    volumes:
      - ./rules.yaml:/etc/guardrail/rules.yaml:ro
    depends_on:
      - redis
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: guardrail-redis
    ports:
      - "6379:6379"
    command: ["redis-server", "--save", "", "--appendonly", "no"]
    restart: unless-stopped

