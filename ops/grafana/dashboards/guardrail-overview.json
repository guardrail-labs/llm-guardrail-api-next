{
  "title": "Guardrail Overview",
  "annotations": [
    {"name": "Alerts", "datasource": "Prometheus Alertmanager"}
  ],
  "links": [
    {
      "title": "Runbook",
      "url": "https://example.com/ops/runbook/guardrail_oncall.md"
    }
  ],
  "panels": [
    {
      "title": "Fallback ratio (5m)",
      "type": "stat",
      "targets": [{"expr": "guardrail:verifier_fallback_ratio"}]
    },
    {
      "title": "Deny ratio (5m)",
      "type": "stat",
      "targets": [{"expr": "guardrail:deny_ratio"}]
    },
    {
      "title": "Redactions per 1k req",
      "type": "stat",
      "targets": [
        {"expr": "guardrail:redactions_per_1k"}
      ]
    },
    {
      "title": "Verifier latency p95",
      "type": "stat",
      "targets": [{"expr": "guardrail:verifier_p95"}]
    },
    {
      "title": "Decisions by family",
      "type": "graph",
      "stack": true,
      "targets": [
        {"expr": "sum by (family) (rate(guardrail_decisions_total[5m]))"}
      ]
    },
    {
      "title": "PDF hidden text reasons",
      "type": "graph",
      "targets": [
        {"expr": "sum by (reason) (rate(guardrail_pdf_hidden_total[5m]))"}
      ]
    },
    {
      "title": "HTML hidden text reasons",
      "type": "graph",
      "targets": [
        {"expr": "sum by (reason) (rate(guardrail_html_hidden_total[5m]))"}
      ]
    },
    {
      "title": "DOCX hidden text reasons",
      "type": "graph",
      "targets": [
        {"expr": "sum by (reason) (rate(guardrail_docx_hidden_total[5m]))"}
      ]
    },
    {
      "title": "Verifier latency p95 heatmap",
      "type": "heatmap",
      "targets": [{"expr": "guardrail:verifier_p95"}]
    },
    {
      "title": "Verifier latency p50",
      "type": "heatmap",
      "targets": [{"expr": "guardrail:verifier_p50"}]
    },
    {
      "title": "Verifier latency p99",
      "type": "heatmap",
      "targets": [{"expr": "guardrail:verifier_p99"}]
    },
    {
      "title": "Verifier fallback rate",
      "type": "graph",
      "targets": [
        {"expr": "guardrail:verifier_fallback_ratio"}
      ]
    },
    {
      "title": "Tenant/bot decisions",
      "type": "table",
      "targets": [
        {
          "expr": "sum by (tenant, bot, family) (rate(guardrail_decisions_family_bot_total[5m]))"
        }
      ]
    }
  ]
}
