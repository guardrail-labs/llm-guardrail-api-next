image:
  repository: ghcr.io/guardrail-labs/llm-guardrail-api-next
  tag: latest
  pullPolicy: IfNotPresent

imagePullSecrets: []

nameOverride: ""
fullnameOverride: ""

replicaCount: 2

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8000"
  prometheus.io/path: "/metrics"

podLabels: {}

serviceAccount:
  create: true
  name: ""

podSecurityContext: {}
securityContext: {}

service:
  type: ClusterIP
  port: 80
  targetPort: 8000

ingress:
  enabled: true
  className: "nginx"
  annotations: {}
  hosts:
    - host: guardrail.localtest.me
      paths:
        - path: /
          pathType: Prefix
  tls: []

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 512Mi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 6
  targetCPUUtilizationPercentage: 70

podDisruptionBudget:
  enabled: true
  minAvailable: 1

rules:
  version: "3"
  inline: |
    version: "3"
    rules:
      - id: "payload:prompt_injection_phrase"
        description: "Block obvious prompt injection"
        type: "regex"
        pattern: "(?i)ignore previous instructions|reveal system prompt"
        action: "block"

      - id: "payload:encoded_blob"
        description: "Suspicious long base64-like run"
        type: "regex"
        pattern: "^[A-Za-z0-9+/=]{128,}$"
        action: "block"

      - id: "payload:secret_tokens"
        description: "Common API key patterns"
        type: "regex"
        pattern: "(sk-[A-Za-z0-9]{16,}|AKIA[0-9A-Z]{16,}|BEGIN PRIVATE KEY|END PRIVATE KEY)"
        action: "block"

# ---- Auth / Env ----
env:
  # API key (used in api_key mode)
  API_KEY: "change-me-prod-key"

  # Auth mode
  AUTH_MODE: "api_key"          # "api_key" or "jwt"

  # JWT (use either JWKS/RS256 or HS256)
  JWT_JWKS_URL: ""
  JWT_ISSUER: ""
  JWT_AUDIENCE: ""
  JWT_HS256_SECRET: ""

  # Policy
  POLICY_AUTORELOAD: "true"
  POLICY_RULES_PATH: "/etc/guardrail/rules.yaml"

  # Limits
  MAX_PROMPT_CHARS: "20000"
  OUTPUT_MAX_CHARS: "20000"

  # Redaction & Audit
  REDACT_SECRETS: "true"
  AUDIT_ENABLED: "true"
  AUDIT_SAMPLE_RATE: "0.2"
  AUDIT_MAX_TEXT_CHARS: "200"

  # Rate limit
  RATE_LIMIT_ENABLED: "false"
  RATE_LIMIT_PER_MINUTE: "120"
  RATE_LIMIT_BURST: "120"
  RATE_LIMIT_BACKEND: "memory"   # memory | redis
  REDIS_URL: ""                  # e.g. redis://redis:6379/0

  # Metrics / tracing
  METRICS_ENABLED: "true"
  OTEL_EXPORTER_OTLP_ENDPOINT: ""

envFrom: []

nodeSelector: {}
tolerations: []
affinity: {}
topologySpreadConstraints: []

extraVolumes: []
extraVolumeMounts: []

